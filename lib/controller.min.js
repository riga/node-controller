var util=require("util"),Class=require("./class.min"),extend=require("./extend.min");var defaultConfig={index:"index",scheme:"_%s_",};var Controller=Class.extend({init:function(b,a){this.parent=b||"root";
this.config=extend({},defaultConfig,a);},bind:function(c,b){var a=this;b=b||"/";c.all("/*",function(g,d,f){var e=new RegExp("^"+a.cutTrainlingSlash(b)+"/?");
if(e.test(g.url)){g.url=a.__shiftUrl(g.url,b);a.__dispatch(g,d,f);}else{f();}});return this;},__dispatch:function(e,b,d){var a=this.__firstRoute(e.url)||this.config.index;
var c=this.__handler(a);if(this[a] instanceof Controller){e.url=this.__shiftUrl(e.url);this[a].__dispatch(e,b,d);}else{if(this[c] instanceof Function){this[c](e,b);
}else{d();}}return this;},__handler:function(a){return util.format(this.config.scheme,a);},__firstRoute:function(a){var b=a.match(/^\/?([^\/]+).*$/);return b?b[1]:"";
},__shiftUrl:function(b,a){a=a===undefined?this.__firstRoute(b):this.cutSlashes(a);var b=!a?b:b.replace(new RegExp("^/?"+a),"");return b||"/";},findRoot:function(){var a=this.parent;
while(a instanceof Controller){a=a.parent;}return a;},isRoot:function(){return this.findRoot()==this.parent;},cutTrainlingSlash:function(a,c){var b=a.match(/^(.*)\/+$/)||a.match(/^(.*)$/);
return(b?b[1]:"")+(c||"");},cutLeadingSlash:function(a,c){var b=a.match(/^\/+(.*)$/)||a.match(/^(.*)$/);return(c||"")+(b?b[1]:"");},cutSlashes:function(a,b,c){return this.cutTrainlingSlash(this.cutLeadingSlash(a,b),c);
}});module.exports=Controller;